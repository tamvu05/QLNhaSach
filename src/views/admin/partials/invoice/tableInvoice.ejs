<% 
    const TRANG_THAI = {
        'CHO_XAC_NHAN': 'Chờ xác nhận',
        'DANG_CHUAN_BI_HANG': 'Đang chuẩn bị hàng',
        'DA_GIAO_CHO_DON_VI_VAN_CHUYEN': 'Đã giao cho đơn vị vận chuyển'
    }

    const HINH_THUC_THANH_TOAN = {
        'COD': 'Thanh toán khi nhận hàng',
        'MOMO': 'Thanh toán qua momo',
        'CASH': 'Thanh toán tiền mặt',
        'BANK_TRANSFER': 'Thanh toán ngân hàng'
    }

    const getPrice = (price) => {
        const numericPrice = Number(price);

        if (isNaN(numericPrice)) {
            return '0 ₫';
        }

        const formatter = new Intl.NumberFormat('vi-VN', {
            style: 'currency',
            currency: 'VND',
            minimumFractionDigits: 0, 
        });

        return formatter.format(numericPrice);
    }

    const getTime7 = (time) => {
        return time.toLocaleString('vi-VN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        })
    }
%>

<div id="data-attribute"     data-current-page="<%= currentPage %>"     data-total-page="<%= totalPage %>"    
    data-total-item="<%= totalItem %>"     data-total-item-per-page="<%= totalItemPerPage %>"    
    data-page-limit="<%= PAGE_LIMIT %>"></div>

<div class="table-responsive-wrapper">
    <table class="table table-striped table-hover align-middle">
        <thead>
            <tr>
                <th>Mã đơn</th>
                <th>Số điện thoại</th>
                <th>Ngày tạo</th>
                <th>Tổng tiền</th>
                <th>Hình thức thanh toán</th>
                <th class="text-center">Thao tác</th>
            </tr>
        </thead>
        <tbody>

            <% if (invoices.length> 0) { %>

                <% invoices.forEach((invoice)=> { %>

                    <tr data-id="<%= invoice.MaDH %>" data-status="<%= invoice.TrangThai %>">
                        <td>
                            <%= invoice.MaDH %>
                        </td>
                        <td>
                            <%= invoice.SDT %>
                        </td>
                        <td class="text-muted">
                            <%= getTime7(invoice.NgayTaoHoaDon) %>
                        </td>
                        <td class="text-muted">
                            <%= getPrice(invoice.TongTien) %> 
                        </td>
                        <td class="text-muted">
                            <%= HINH_THUC_THANH_TOAN[invoice.HinhThucThanhToan] %> 
                        </td>
                        <td class="action-col text-center">
                            <button class="btn-show-details btn action-btn view-btn" title="Xem chi tiết">
                                <i class="fa-solid fa-eye"></i> 
                            </button>
                        </td>
                    </tr>
                    <% }) %>
                        <% } else { %>

                            <tr class="no-data">
                                <td colspan="6" class="text-center py-4">
                                    Không có dữ liệu...
                                </td>
                            </tr>

                            <% } %>
        </tbody>
    </table>
</div>
